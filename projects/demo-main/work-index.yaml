# yaml-language-server: $schema=./SCHEMA/work-flow-schema.json

sprints:
- id: gcp-cicd-foundation
  title: GCP CI/CD Foundation (WS1)
  file: GCP-CICD-FOUNDATION.md
  status: active
  goal: Establish GCP state backend integration and GitHub Actions CI/CD with Workload
    Identity Federation, mirroring the existing AWS OIDC pattern
  themes:
  - gcp-cicd
  - infrastructure
  - devops
  stories:
  - id: STORY-1
    status: done
    notes: Bootstrap audit complete. Old bucket preserved (account-management workspace
      intact). New bootstrap created with dmo-terraform-* naming, state migrated to
      GCS. Workspace support deferred to backlog.
  - id: STORY-2
    status: done
    notes: 'WIF pool (github-pool), provider (github-provider), and per-repo SA bindings
      created in bootstrap apply. Provider: projects/94087649681/locations/global/workloadIdentityPools/github-pool/providers/github-provider.
      SA: dmo-terraform-github@dmo-tf-res-x3pme6r0.iam.gserviceaccount.com'
  - id: STORY-3
    status: done
    notes: GCP multi-project setup composite action complete. Created .github/actions/gcp-multi-project-setup/action.yml
      with WIF auth via google-github-actions/auth@v2, gcloud CLI setup via setup-gcloud@v2,
      Terraform 1.10.5, and outputs for project-id and credentials-file.
  - id: STORY-4
    status: done
    notes: GCP Schema & Config Baseline complete. Added 10 GCP struct types to synthctl/internal/schema/types.go
      (GCPNetworkZone, GCEInstance, GKECluster, CloudSQLInstance, CloudStorageBucket,
      GCPServiceAccount, GCPCustomIAMRole, GCPInstanceServiceAccount, GCPStackConfig,
      GCPSides). Updated generator.go to use real types instead of placeholder. Added
      GCP detection in validator.go. Rebuilt synthctl, regenerated schemas/infrastructure.json
      with full GCP definitions. Created config/infrastructure.d/gcp.demo.auto.tfvars.json
      baseline config that validates against schema.
  - id: STORY-5
    status: done
    notes: Parameterized plan/deploy/destroy workflows with csp input (aws/gcp choice).
      CSP-gated auth steps, computed env vars (TF_WORKING_DIR, TF_PLAN_FILE, TF_BACKEND_CONFIG),
      EKS kubeconfig gated to AWS, post-deploy/pre-destroy gated to AWS. Created config/providers.d/gcp.demo.auto.tfvars.json.
      AWS default behavior preserved. Requires TF_GCP_ROOT_BACKEND repo variable.
  - id: STORY-6
    status: planned
    notes: "Mirror setup/cross-account/aws/ for GCP \u2014 create deployment service\
      \ accounts in attacker/target GCP projects with Workload Identity Federation\
      \ trust back to the management project's WIF pool. Equivalent of synthctl-deployment-role\
      \ IAM roles. State remains in management project GCS bucket."
  - id: STORY-5b
    status: done
    notes: Added --type providers to synthctl schema generator. Created GCPProviders
      struct in providers.go, GenerateProvidersSchema in generator.go, wired into
      CLI. Rebuilt synthctl, regenerated schemas/providers.json. All 4 existing providers
      files validate. Updated both schemas/README.md and synthctl/README.md.
- id: synthctl-git-repo-rename
  title: Synthctl Git Repo Rename
  file: SYNTHCTL-GIT-REPO-RENAME.md
  status: completed
  goal: Replace all references to github.com/lacework-dev/synthctl with github.com/proservlab/synthctl
    as part of the repo migration
  themes:
  - repo-migration
  - go-mod
  - synthctl
  stories:
  - id: STORY-7
    status: done
    notes: Completed migration refs to github.com/proservlab/synthctl, regenerated
      schemas, fixed schema validation issues (scenario/applications + regex), updated
      schema $id for config/combined to avoid double schemas path, and smoke-tested
      synthctl CLI (go test ./internal/cli/... passes).
- id: gcp-compute-parity
  title: GCP Compute Instance Parity
  file: GCP-COMPUTE-PARITY.md
  status: active
  goal: 'Bring GCE instance creation to parity with AWS EC2: SSH key management via
    Secret Manager, GCP-native bootstrapping scripts, configurable boot disk, instance
    metadata for accessibility, and structured outputs'
  themes:
  - gcp
  - compute
  - parity
  stories:
  - id: STORY-8
    status: done
    notes: 'Create tls_private_key (RSA 4096) resource. Store private key PEM and
      public key OpenSSH in google_secret_manager_secret_version resources. GCP equivalent
      of the AWS ssh-keys-kms module at terraform/stacks/aws/modules/ssh-keys-kms/.
      Conditionally created only when GCE instances exist (count = length(local.gce_enabled)
      > 0 ? 1 : 0). Reference: terraform-org-management gce/ssh.tf pattern.'
  - id: STORY-9
    status: done
    notes: 'Switch GCE module from terraform-google-modules/vm/google//modules/instance_template
      to a direct google_compute_instance resource. Include: (1) boot_disk with configurable
      size via root_volume_size config field, defaults to 30 for Windows, 15 for Linux
      (matching AWS EC2 pattern); (2) network_interface wired to the correct public/private
      subnet from module.network; (3) service_account block with cloud-platform scope;
      (4) static external IP for public instances via google_compute_address; (5)
      SSH public key injection via metadata ssh-keys field. Depends on STORY-8 for
      SSH key. Reference: terraform-org-management gce/instance/main.tf.'
  - id: STORY-10
    status: done
    notes: "Linux: Wire bootstrap.sh template as metadata_startup_script with GCP-native\
      \ setup (apt/yum wait loop, google-osconfig-agent install, optional swap, optional\
      \ secondary disk mount, additional_tasks). No SSM agent \u2014 GCP uses osconfig\
      \ instead. Windows: Wire bootstrap.ps1 template as sysprep-specialize-script-ps1\
      \ metadata key with csp=gcp, instance_name, and public_key_openssh template\
      \ vars. Instance metadata flags: enable-osconfig=true, enable-oslogin=true,\
      \ serial-port-enable=true, enable-windows-ssh (conditional), enable-windows-automatic-updates\
      \ (conditional). OS detection via startswith(image_name, windows_). Depends\
      \ on STORY-9 for the google_compute_instance resource. Reference: terraform-org-management\
      \ gce/instance/main.tf lines 93-106."
  - id: STORY-11
    status: planned
    notes: 'Expose GCE instance details in the stack output matching the AWS EC2 output
      shape: instance id, name, private_ip (network_interface.0.network_ip), public_ip
      (access_config.0.nat_ip), base64-encoded ssh_key_public and ssh_key (private
      key PEM), labels, project_id, region. Update terraform/root/gcp/outputs.tf to
      surface GCE data alongside existing GKE outputs. Reference: terraform-org-management
      gce/outputs.tf pattern. Depends on STORY-10 for complete instance resource.'
  - id: STORY-12
    status: planned
    notes: 'Full schema pipeline update for new GCE instance config fields added in
      STORY-9/10. Chain: (1) Update synthctl Go types in internal/infrastructure/
      to add new GCEInstance fields (root_volume_size, enable_swap, enable_secondary_volume,
      secondary_disk_size, user_data, user_data_base64). (2) Rebuild synthctl and
      regenerate schemas/infrastructure.json via synthctl schema generate --type infrastructure
      --provider gcp. (3) Update terraform-ui configSchema.js to include new GCE fields
      in the form builder. (4) Update terraform-ui componentLibrary.js with appropriate
      input components (number spinner for volume sizes, toggles for booleans). Validate:
      all 4 existing GCP infra configs pass schema validation. Depends on STORY-9
      and STORY-10 to know the final field set.'
backlog:
- id: cicd-sha-pinning
  theme: devops
  summary: Pin all GitHub Actions to SHA-256 digests instead of semantic versions
  status: todo
  related_sprints: []
- id: cicd-secrets-to-encrypted
  theme: security
  summary: Move base64 variables to encrypted GitHub Secrets for backend config
  status: todo
  related_sprints: []
- id: cicd-hardcode-org-removal
  theme: devops
  summary: Replace hardcoded proservlab org name with github.repository_owner variable
  status: todo
  related_sprints: []
- id: cicd-add-testing-workflow
  theme: devops
  summary: Add terraform validate and fmt check workflow for pull requests
  status: todo
  related_sprints: []
- id: cicd-add-security-scanning
  theme: security
  summary: Add tfsec checkov and dependency scanning workflows for pull requests
  status: todo
  related_sprints: []
- id: cicd-secret-masking
  theme: security
  summary: Add add-mask directives for MongoDB passwords and SSM parameters in logs
  status: todo
  related_sprints: []
- id: cicd-retry-logic
  theme: devops
  summary: Implement exponential backoff retry for SSM and kubectl transient failures
  status: todo
  related_sprints: []
- id: tf-azure-keyvault-fix
  theme: infrastructure
  summary: Separate Azure Key Vault instances for compute and SQL secret management
  status: todo
  related_sprints: []
- id: tf-variable-validation
  theme: infrastructure
  summary: Add validation blocks to complex Terraform input variable definitions
  status: todo
  related_sprints: []
- id: tf-lacework-provider-sync
  theme: infrastructure
  summary: Synchronize Lacework provider status across AWS GCP and Azure roots
  status: todo
  related_sprints: []
- id: tf-state-recovery-runbook
  theme: infrastructure
  summary: Document state lockout recovery procedures for central management account
  status: todo
  related_sprints: []
- id: tf-portable-backend-names
  theme: infrastructure
  summary: Make S3 bucket and DynamoDB table names configurable via variables
  status: todo
  related_sprints: []
- id: synthctl-cli-test-coverage
  theme: testing
  summary: Achieve 60 percent CLI test coverage by refactoring flag exit handling
  status: todo
  related_sprints: []
- id: synthctl-reduce-duplication
  theme: code-quality
  summary: Extract shared exec and las patterns to reduce 150 duplicated lines
  status: todo
  related_sprints: []
- id: synthctl-lacework-full-api
  theme: feature
  summary: Complete Lacework API integration coverage beyond current query runner
  status: todo
  related_sprints: []
- id: docs-implement-security-controls
  theme: security
  summary: Implement planned security controls Falco SCPs audit logs kube-bench
  status: todo
  related_sprints: []
- id: demo-hardening
  theme: security
  summary: Apply demo hardening recommendations from DEMO-HARDENING.md runbook document
  status: todo
  related_sprints: []
- id: argocd-rbac-scoping
  theme: security
  summary: Scope ArgoCD manager ClusterRole from wildcard to specific resource types
  status: todo
  related_sprints: []
- id: submodule-maintenance
  theme: infrastructure
  summary: Keep submodule references up to date across all 12 modules
  status: in_progress
  related_sprints: []
- id: terraform-ui-migration
  theme: frontend
  summary: Complete Next.js App Router migration for terraform-ui submodule
  status: todo
  related_sprints: []
- id: argocd-cleanup
  theme: infrastructure
  summary: Improve ArgoCD cleanup steps for timeout handling and error management
  status: done
  related_sprints: []
- id: gcp-tf-stack-audit
  theme: gcp-terraform
  summary: Audit GCP TF stack (246 lines) against AWS stack (1,785 lines) to identify
    missing resource types and module gaps
  status: todo
  related_sprints:
  - gcp-cicd-foundation
- id: gcp-gke-autoscale-module
  theme: gcp-terraform
  summary: Create GKE autoscale module (GCP equivalent of eks-autoscale) with Workload
    Identity instead of IRSA
  status: todo
  related_sprints: []
- id: gcp-gcs-with-iam-module
  theme: gcp-terraform
  summary: "Create GCS-with-IAM module (GCP equivalent of s3-with-iam) \u2014 bucket\
    \ + IAM bindings + VPC Service Controls"
  status: todo
  related_sprints: []
- id: gcp-cloudsql-backup-module
  theme: gcp-terraform
  summary: "Create CloudSQL-GCS-backup module (GCP equivalent of rds-s3-backup) \u2014\
    \ Cloud SQL + automated export to GCS"
  status: todo
  related_sprints: []
- id: gcp-ssh-sa-key-modules
  theme: gcp-terraform
  summary: "Create GCP key management modules \u2014 SA keys + Cloud KMS + Secret\
    \ Manager (equivalents of iam-keys-kms, ssh-keys-kms, iam-key-to-ssm-user)"
  status: todo
  related_sprints: []
- id: gcp-firewall-trusts-module
  theme: gcp-terraform
  summary: Create GCP firewall trusts module (equivalent of security-group-trusts)
    using GCP firewall rules for trusted IPs/tags
  status: todo
  related_sprints: []
- id: gcp-root-module-review
  theme: gcp-terraform
  summary: Review terraform/root/gcp/ to verify attacker/target provider aliases wire
    correctly through to stacks
  status: todo
  related_sprints: []
- id: gcp-synthctl-types
  theme: gcp-synthctl
  summary: "Define GCP Go types in schema/types.go \u2014 GCPSides, GCPStackConfig,\
    \ GCEInstance, GCPBucket, GKECluster, GCPServiceAccount, etc."
  status: done
  related_sprints:
  - gcp-cicd-foundation
- id: gcp-synthctl-providers
  theme: gcp-synthctl
  summary: Add GCPProviders struct to providers.go with project IDs and regions for
    attacker/target, update Doc struct and validation
  status: todo
  related_sprints: []
- id: gcp-synthctl-generator
  theme: gcp-synthctl
  summary: Replace GCP placeholder in generator.go with actual GCPStackConfig type
    reflection for schema generation
  status: done
  related_sprints:
  - gcp-cicd-foundation
- id: gcp-synthctl-cli-init
  theme: gcp-synthctl
  summary: Extend synthctl providers init CLI to accept --gcp-attacker-project, --gcp-target-project,
    --gcp-*-region flags
  status: todo
  related_sprints: []
- id: gcp-schemas-regenerate
  theme: gcp-synthctl
  summary: Regenerate local schemas/ via synthctl schema generate --provider gcp once
    Go types are defined
  status: done
  related_sprints:
  - gcp-cicd-foundation
- id: gcp-ui-component-audit
  theme: gcp-ui
  summary: Audit terraform-ui componentLibrary.js GCP components against actual TF
    stack resources for completeness
  status: todo
  related_sprints: []
- id: gcp-ui-schema-audit
  theme: gcp-ui
  summary: Audit terraform-ui configSchemas.js GCP fields against actual Terraform
    variable names for accuracy
  status: todo
  related_sprints: []
- id: gcp-ui-export-validation
  theme: gcp-ui
  summary: Validate that terraform-ui auto.tfvars.json export for GCP scenarios produces
    valid input for terraform/root/gcp/
  status: todo
  related_sprints: []
- id: gcp-ui-schema-sync
  theme: gcp-ui
  summary: Sync terraform-ui validation against regenerated JSON schemas from synthctl
    after GCP types are added
  status: todo
  related_sprints: []
- id: gcp-bootstrap-workspace
  theme: gcp-cicd
  summary: Add workspace support to GCP bootstrap for multi-environment isolation
    (e.g., bootstrap per org/billing account). Migrate default state to named workspace.
  status: todo
  related_sprints:
  - gcp-cicd-foundation
history:
- date: '2026-02-24'
  summary: Registered demo-main in WorkSync. Initial backlog populated from repo analysis.
- date: '2026-02-24'
  summary: Updated subproject commit references in scripts and terraform.
  related_sprints: []
- date: '2026-02-24'
  summary: 'Deep WorkSync review: 4 parallel analyses (CI/CD, Terraform, Apps/ArgoCD,
    synthctl/docs). Expanded backlog from 5 to 21 items across 8 themes. CI/CD scored
    5.5/10, synthctl CLI at 0% test coverage, terraform-ui production-ready.'
  related_sprints: []
- date: '2026-02-25'
  summary: "Scoped GCP support across 4 workstreams (22 items): WS1 CI/CD Foundation\
    \ (6 stories, sprinted), WS2 TF Module Parity (7 backlog), WS3 synthctl Schema\
    \ (5 backlog), WS4 terraform-ui Alignment (4 backlog). GCP is ~30% built \u2014\
    \ UI layer ahead, CI/CD and synthctl schema are major gaps."
  related_sprints:
  - gcp-cicd-foundation
- date: '2026-02-26'
  summary: 'Completed STORY-1: Bootstrap audit complete. Old bucket preserved (account-management
    workspace intact). New bootstrap created with dmo-terraform-* naming, state migrated
    to GCS. Workspace support deferred to backlog.'
  related_sprints:
  - gcp-cicd-foundation
- date: '2026-02-26'
  summary: 'Completed STORY-2: WIF pool (github-pool), provider (github-provider),
    and per-repo SA bindings created in bootstrap apply. Provider: projects/94087649681/locations/global/workloadIdentityPools/github-pool/providers/github-provider.
    SA: dmo-terraform-github@dmo-tf-res-x3pme6r0.iam.gserviceaccount.com'
  related_sprints:
  - gcp-cicd-foundation
- date: '2026-02-26'
  summary: 'Completed STORY-4: GCP Schema & Config Baseline complete. Added 10 GCP
    struct types to synthctl/internal/schema/types.go (GCPNetworkZone, GCEInstance,
    GKECluster, CloudSQLInstance, CloudStorageBucket, GCPServiceAccount, GCPCustomIAMRole,
    GCPInstanceServiceAccount, GCPStackConfig, GCPSides). Updated generator.go to
    use real types instead of placeholder. Added GCP detection in validator.go. Rebuilt
    synthctl, regenerated schemas/infrastructure.json with full GCP definitions. Created
    config/infrastructure.d/gcp.demo.auto.tfvars.json baseline config that validates
    against schema.'
  related_sprints:
  - gcp-cicd-foundation
- date: '2026-02-26'
  summary: 'Completed STORY-3: GCP multi-project setup composite action complete.
    Created .github/actions/gcp-multi-project-setup/action.yml with WIF auth via google-github-actions/auth@v2,
    gcloud CLI setup via setup-gcloud@v2, Terraform 1.10.5, and outputs for project-id
    and credentials-file.'
  related_sprints:
  - gcp-cicd-foundation
- date: '2026-02-26'
  summary: 'Completed STORY-5b: Added --type providers to synthctl schema generator.
    Created GCPProviders struct in providers.go, GenerateProvidersSchema in generator.go,
    wired into CLI. Rebuilt synthctl, regenerated schemas/providers.json. All 4 existing
    providers files validate. Updated both schemas/README.md and synthctl/README.md.'
  related_sprints:
  - gcp-cicd-foundation
- date: '2026-02-26'
  summary: 'Completed STORY-7: Completed migration refs to github.com/proservlab/synthctl,
    regenerated schemas, fixed schema validation issues (scenario/applications + regex),
    updated schema $id for config/combined to avoid double schemas path, and smoke-tested
    synthctl CLI (go test ./internal/cli/... passes).'
  related_sprints:
  - synthctl-git-repo-rename
