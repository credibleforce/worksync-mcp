# yaml-language-server: $schema=./SCHEMA/work-flow-schema.json

sprints:
- id: gcp-cicd-foundation
  title: GCP CI/CD Foundation (WS1)
  file: GCP-CICD-FOUNDATION.md
  status: active
  goal: Establish GCP state backend integration and GitHub Actions CI/CD with Workload
    Identity Federation, mirroring the existing AWS OIDC pattern
  themes:
  - gcp-cicd
  - infrastructure
  - devops
  stories:
  - id: STORY-1
    status: done
    notes: Bootstrap audit complete. Old bucket preserved (account-management workspace
      intact). New bootstrap created with dmo-terraform-* naming, state migrated to
      GCS. Workspace support deferred to backlog.
  - id: STORY-2
    status: done
    notes: 'WIF pool (github-pool), provider (github-provider), and per-repo SA bindings
      created in bootstrap apply. Provider: projects/94087649681/locations/global/workloadIdentityPools/github-pool/providers/github-provider.
      SA: dmo-terraform-github@dmo-tf-res-x3pme6r0.iam.gserviceaccount.com'
  - id: STORY-3
    status: in_progress
    notes: 'Create .github/actions/gcp-multi-project-setup/action.yml composite action.
      Mirror aws-multi-account-setup pattern: exchange GitHub OIDC token via google-github-actions/auth,
      configure gcloud CLI, set up project-level access for attacker/target projects.
      Use Terraform version 1.10.5 (matching AWS action). Outputs: authenticated gcloud
      context, available project IDs.'
  - id: STORY-4
    status: done
    notes: GCP Schema & Config Baseline complete. Added 10 GCP struct types to synthctl/internal/schema/types.go
      (GCPNetworkZone, GCEInstance, GKECluster, CloudSQLInstance, CloudStorageBucket,
      GCPServiceAccount, GCPCustomIAMRole, GCPInstanceServiceAccount, GCPStackConfig,
      GCPSides). Updated generator.go to use real types instead of placeholder. Added
      GCP detection in validator.go. Rebuilt synthctl, regenerated schemas/infrastructure.json
      with full GCP definitions. Created config/infrastructure.d/gcp.demo.auto.tfvars.json
      baseline config that validates against schema.
  - id: STORY-5
    status: planned
    notes: 'Create GCP GitHub Actions workflows: terraform-plan-gcp.yml, terraform-deploy-gcp.yml,
      terraform-destroy-gcp.yml. Alternative: parameterize existing AWS workflows
      to accept CSP input. Must use id-token:write permission, call gcp-multi-project-setup
      action, use GCS backend. Reference existing: terraform-plan.yml, terraform-deploy.yml,
      terraform-destroy.yml.'
  - id: STORY-6
    status: planned
    notes: "Mirror setup/cross-account/aws/ for GCP \u2014 create deployment service\
      \ accounts in attacker/target GCP projects with Workload Identity Federation\
      \ trust back to the management project's WIF pool. Equivalent of synthctl-deployment-role\
      \ IAM roles. State remains in management project GCS bucket."
backlog:
- id: cicd-sha-pinning
  theme: devops
  summary: Pin all GitHub Actions to SHA-256 digests instead of semantic versions
  status: todo
  related_sprints: []
- id: cicd-secrets-to-encrypted
  theme: security
  summary: Move base64 variables to encrypted GitHub Secrets for backend config
  status: todo
  related_sprints: []
- id: cicd-hardcode-org-removal
  theme: devops
  summary: Replace hardcoded proservlab org name with github.repository_owner variable
  status: todo
  related_sprints: []
- id: cicd-add-testing-workflow
  theme: devops
  summary: Add terraform validate and fmt check workflow for pull requests
  status: todo
  related_sprints: []
- id: cicd-add-security-scanning
  theme: security
  summary: Add tfsec checkov and dependency scanning workflows for pull requests
  status: todo
  related_sprints: []
- id: cicd-secret-masking
  theme: security
  summary: Add add-mask directives for MongoDB passwords and SSM parameters in logs
  status: todo
  related_sprints: []
- id: cicd-retry-logic
  theme: devops
  summary: Implement exponential backoff retry for SSM and kubectl transient failures
  status: todo
  related_sprints: []
- id: tf-azure-keyvault-fix
  theme: infrastructure
  summary: Separate Azure Key Vault instances for compute and SQL secret management
  status: todo
  related_sprints: []
- id: tf-variable-validation
  theme: infrastructure
  summary: Add validation blocks to complex Terraform input variable definitions
  status: todo
  related_sprints: []
- id: tf-lacework-provider-sync
  theme: infrastructure
  summary: Synchronize Lacework provider status across AWS GCP and Azure roots
  status: todo
  related_sprints: []
- id: tf-state-recovery-runbook
  theme: infrastructure
  summary: Document state lockout recovery procedures for central management account
  status: todo
  related_sprints: []
- id: tf-portable-backend-names
  theme: infrastructure
  summary: Make S3 bucket and DynamoDB table names configurable via variables
  status: todo
  related_sprints: []
- id: synthctl-cli-test-coverage
  theme: testing
  summary: Achieve 60 percent CLI test coverage by refactoring flag exit handling
  status: todo
  related_sprints: []
- id: synthctl-reduce-duplication
  theme: code-quality
  summary: Extract shared exec and las patterns to reduce 150 duplicated lines
  status: todo
  related_sprints: []
- id: synthctl-lacework-full-api
  theme: feature
  summary: Complete Lacework API integration coverage beyond current query runner
  status: todo
  related_sprints: []
- id: docs-implement-security-controls
  theme: security
  summary: Implement planned security controls Falco SCPs audit logs kube-bench
  status: todo
  related_sprints: []
- id: demo-hardening
  theme: security
  summary: Apply demo hardening recommendations from DEMO-HARDENING.md runbook document
  status: todo
  related_sprints: []
- id: argocd-rbac-scoping
  theme: security
  summary: Scope ArgoCD manager ClusterRole from wildcard to specific resource types
  status: todo
  related_sprints: []
- id: submodule-maintenance
  theme: infrastructure
  summary: Keep submodule references up to date across all 12 modules
  status: in_progress
  related_sprints: []
- id: terraform-ui-migration
  theme: frontend
  summary: Complete Next.js App Router migration for terraform-ui submodule
  status: todo
  related_sprints: []
- id: argocd-cleanup
  theme: infrastructure
  summary: Improve ArgoCD cleanup steps for timeout handling and error management
  status: done
  related_sprints: []
- id: gcp-tf-stack-audit
  theme: gcp-terraform
  summary: Audit GCP TF stack (246 lines) against AWS stack (1,785 lines) to identify
    missing resource types and module gaps
  status: todo
  related_sprints:
  - gcp-cicd-foundation
- id: gcp-gke-autoscale-module
  theme: gcp-terraform
  summary: Create GKE autoscale module (GCP equivalent of eks-autoscale) with Workload
    Identity instead of IRSA
  status: todo
  related_sprints: []
- id: gcp-gcs-with-iam-module
  theme: gcp-terraform
  summary: "Create GCS-with-IAM module (GCP equivalent of s3-with-iam) \u2014 bucket\
    \ + IAM bindings + VPC Service Controls"
  status: todo
  related_sprints: []
- id: gcp-cloudsql-backup-module
  theme: gcp-terraform
  summary: "Create CloudSQL-GCS-backup module (GCP equivalent of rds-s3-backup) \u2014\
    \ Cloud SQL + automated export to GCS"
  status: todo
  related_sprints: []
- id: gcp-ssh-sa-key-modules
  theme: gcp-terraform
  summary: "Create GCP key management modules \u2014 SA keys + Cloud KMS + Secret\
    \ Manager (equivalents of iam-keys-kms, ssh-keys-kms, iam-key-to-ssm-user)"
  status: todo
  related_sprints: []
- id: gcp-firewall-trusts-module
  theme: gcp-terraform
  summary: Create GCP firewall trusts module (equivalent of security-group-trusts)
    using GCP firewall rules for trusted IPs/tags
  status: todo
  related_sprints: []
- id: gcp-root-module-review
  theme: gcp-terraform
  summary: Review terraform/root/gcp/ to verify attacker/target provider aliases wire
    correctly through to stacks
  status: todo
  related_sprints: []
- id: gcp-synthctl-types
  theme: gcp-synthctl
  summary: "Define GCP Go types in schema/types.go \u2014 GCPSides, GCPStackConfig,\
    \ GCEInstance, GCPBucket, GKECluster, GCPServiceAccount, etc."
  status: done
  related_sprints:
  - gcp-cicd-foundation
- id: gcp-synthctl-providers
  theme: gcp-synthctl
  summary: Add GCPProviders struct to providers.go with project IDs and regions for
    attacker/target, update Doc struct and validation
  status: todo
  related_sprints: []
- id: gcp-synthctl-generator
  theme: gcp-synthctl
  summary: Replace GCP placeholder in generator.go with actual GCPStackConfig type
    reflection for schema generation
  status: done
  related_sprints:
  - gcp-cicd-foundation
- id: gcp-synthctl-cli-init
  theme: gcp-synthctl
  summary: Extend synthctl providers init CLI to accept --gcp-attacker-project, --gcp-target-project,
    --gcp-*-region flags
  status: todo
  related_sprints: []
- id: gcp-schemas-regenerate
  theme: gcp-synthctl
  summary: Regenerate local schemas/ via synthctl schema generate --provider gcp once
    Go types are defined
  status: done
  related_sprints:
  - gcp-cicd-foundation
- id: gcp-ui-component-audit
  theme: gcp-ui
  summary: Audit terraform-ui componentLibrary.js GCP components against actual TF
    stack resources for completeness
  status: todo
  related_sprints: []
- id: gcp-ui-schema-audit
  theme: gcp-ui
  summary: Audit terraform-ui configSchemas.js GCP fields against actual Terraform
    variable names for accuracy
  status: todo
  related_sprints: []
- id: gcp-ui-export-validation
  theme: gcp-ui
  summary: Validate that terraform-ui auto.tfvars.json export for GCP scenarios produces
    valid input for terraform/root/gcp/
  status: todo
  related_sprints: []
- id: gcp-ui-schema-sync
  theme: gcp-ui
  summary: Sync terraform-ui validation against regenerated JSON schemas from synthctl
    after GCP types are added
  status: todo
  related_sprints: []
- id: gcp-bootstrap-workspace
  theme: gcp-cicd
  summary: Add workspace support to GCP bootstrap for multi-environment isolation
    (e.g., bootstrap per org/billing account). Migrate default state to named workspace.
  status: todo
  related_sprints:
  - gcp-cicd-foundation
history:
- date: '2026-02-24'
  summary: Registered demo-main in WorkSync. Initial backlog populated from repo analysis.
- date: '2026-02-24'
  summary: Updated subproject commit references in scripts and terraform.
  related_sprints: []
- date: '2026-02-24'
  summary: 'Deep WorkSync review: 4 parallel analyses (CI/CD, Terraform, Apps/ArgoCD,
    synthctl/docs). Expanded backlog from 5 to 21 items across 8 themes. CI/CD scored
    5.5/10, synthctl CLI at 0% test coverage, terraform-ui production-ready.'
  related_sprints: []
- date: '2026-02-25'
  summary: "Scoped GCP support across 4 workstreams (22 items): WS1 CI/CD Foundation\
    \ (6 stories, sprinted), WS2 TF Module Parity (7 backlog), WS3 synthctl Schema\
    \ (5 backlog), WS4 terraform-ui Alignment (4 backlog). GCP is ~30% built \u2014\
    \ UI layer ahead, CI/CD and synthctl schema are major gaps."
  related_sprints:
  - gcp-cicd-foundation
- date: '2026-02-26'
  summary: 'Completed STORY-1: Bootstrap audit complete. Old bucket preserved (account-management
    workspace intact). New bootstrap created with dmo-terraform-* naming, state migrated
    to GCS. Workspace support deferred to backlog.'
  related_sprints:
  - gcp-cicd-foundation
- date: '2026-02-26'
  summary: 'Completed STORY-2: WIF pool (github-pool), provider (github-provider),
    and per-repo SA bindings created in bootstrap apply. Provider: projects/94087649681/locations/global/workloadIdentityPools/github-pool/providers/github-provider.
    SA: dmo-terraform-github@dmo-tf-res-x3pme6r0.iam.gserviceaccount.com'
  related_sprints:
  - gcp-cicd-foundation
- date: '2026-02-26'
  summary: 'Completed STORY-4: GCP Schema & Config Baseline complete. Added 10 GCP
    struct types to synthctl/internal/schema/types.go (GCPNetworkZone, GCEInstance,
    GKECluster, CloudSQLInstance, CloudStorageBucket, GCPServiceAccount, GCPCustomIAMRole,
    GCPInstanceServiceAccount, GCPStackConfig, GCPSides). Updated generator.go to
    use real types instead of placeholder. Added GCP detection in validator.go. Rebuilt
    synthctl, regenerated schemas/infrastructure.json with full GCP definitions. Created
    config/infrastructure.d/gcp.demo.auto.tfvars.json baseline config that validates
    against schema.'
  related_sprints:
  - gcp-cicd-foundation
